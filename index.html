<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EnergyPro Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>

<style>
body { margin:0; font-family:Segoe UI; background:#f4f6f9 }
.sidebar {
  width:220px; height:100vh; background:#0a2463;
  color:#fff; position:fixed; padding:20px
}
.sidebar h2 { color:#ffd000 }
.main { margin-left:240px; padding:20px }
.cards {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px
}
.card {
  background:#fff; padding:20px; border-radius:10px;
  box-shadow:0 2px 8px rgba(0,0,0,.1)
}
.value { font-size:28px; font-weight:600 }
.green { color:#2e7d32 }
.red { color:#c62828 }
button {
  padding:10px 20px; border:none; border-radius:5px;
  font-size:16px; cursor:pointer
}
.on { background:#4caf50; color:#fff }
.off { background:#e53935; color:#fff }
</style>
</head>

<body>

<div class="sidebar">
  <h2>âš¡ EnergyPro</h2>
  <p>Dashboard</p>
  <p>Control</p>
  <p>Reports</p>
</div>

<div class="main">
<h1>Energy Dashboard</h1>

<div class="cards">
  <div class="card">
    <div>Balance</div>
    <div class="value green">
      <span id="credit">0</span> kWh
    </div>
  </div>

  <div class="card">
    <div>Voltage</div>
    <div class="value">
      <span id="voltage">0</span> V
    </div>
  </div>

  <div class="card">
    <div>Current</div>
    <div class="value">
      <span id="current">0</span> A
    </div>
  </div>

  <div class="card">
    <div>Active Power</div>
    <div class="value">
      <span id="power">0</span> W
    </div>
  </div>
</div>

<br>

<div class="cards">
  <div class="card">
    <h3>System Status</h3>
    <p>Relay: <b id="relay">---</b></p>
    <p>Total Energy: <b><span id="energy">0</span> kWh</b></p>
    <p>Frequency: <b><span id="freq">0</span> Hz</b></p>
    <p>PF: <b><span id="pf">0</span></b></p>
  </div>

  <div class="card">
    <h3>Quick Actions</h3>
    <button class="on" onclick="setRelay(true)">Power ON</button>
    <button class="off" onclick="setRelay(false)">Power OFF</button>
  </div>
</div>

</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDPy9D_J7YNrQFTZ_sC3w71S5iYIKRWr8g",
  databaseURL: "https://energymeter-6e176-default-rtdb.firebaseio.com/"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

db.ref("/power_meter").on("value", snap => {
  const d = snap.val();
  if(!d) return;

  document.getElementById("voltage").innerText = d.voltage?.toFixed(1);
  document.getElementById("current").innerText = d.current?.toFixed(3);
  document.getElementById("power").innerText   = d.active_power?.toFixed(1);
  document.getElementById("energy").innerText  = d.energy?.toFixed(3);
  document.getElementById("credit").innerText  = d.credit_kwh?.toFixed(3);
  document.getElementById("freq").innerText    = d.frequency?.toFixed(1);
  document.getElementById("pf").innerText      = d.pf?.toFixed(2);

  document.getElementById("relay").innerText =
    d.relay_state ? "ON" : "OFF";
});

function setRelay(state){
  db.ref("/power_meter/relay_state").set(state);
}
</script>

</body>
</html>
